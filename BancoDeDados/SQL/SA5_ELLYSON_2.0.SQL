CREATE DATABASE SA5_ELLYSON
 
 CREATE TABLE IF NOT EXISTS CLIENTES (
    ID_CLIENTES INT  PRIMARY KEY,
    SOBRENOME VARCHAR(30) NOT NULL,
    EMAIL VARCHAR(30) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS PEDIDOS (
    ID_PEDIDOS INT PRIMARY KEY,
    ID_CLIENTES INT NOT NULL,
    DATA_PEDIDO DATE NOT NULL, 
   TOTAL INT NOT NULL
);

 ALTER TABLE  PEDIDOS
ADD CONSTRAINT ID_CLIENTES
  FOREIGN KEY (ID_CLIENTES) REFERENCES CLIENTES

  CREATE TABLE IF NOT EXISTS PRODUTOS (
    ID_PRODUTOS INT PRIMARY KEY,
    PNOME INT NOT NULL,
    DESCRICAO DATE NOT NULL,
   PRECO DECIMAL(10,2)
);

ALTER TABLE Produtos
ADD CONSTRAINT PRECO CHECK (PreCo >= 0);

CREATE TABLE IF NOT EXISTS CATEGORIAS (
    ID_CATEGORIAS INT  PRIMARY KEY,
    CNOME VARCHAR(30) NOT NULL
);

CREATE TABLE PedidoS_Produtos (
    ID_PEDIDOS INT,
    ID_PRODUTOS INT,
    PRIMARY KEY (ID_PEDIDOS, ID_PRODUTOS),
    FOREIGN KEY (ID_PEDIDOS) REFERENCES PEDIDOS(ID_PEDIDOS),
    FOREIGN KEY (ID_ProdutoS) REFERENCES PRODUTOS(ID_PRODUTOS)
);


CREATE TABLE Produtos_Categorias (
    ID_ProdutoS INT,
    ID_CategoriaS INT,
    PRIMARY KEY (ID_ProdutoS, ID_CategoriaS),
    FOREIGN KEY (ID_ProdutoS) REFERENCES Produtos(ID_ProdutoS),
    FOREIGN KEY (ID_CategoriaS) REFERENCES Categorias(ID_CategoriaS)
);

 CREATE TABLE IF NOT EXISTS EMPREGADOS (
    ID_EMPREGADOS INT  PRIMARY KEY,
    ENOME VARCHAR(30) NOT NULL,
    ESOBRENOME VARCHAR(30) NOT NULL,
    CARGO VARCHAR(20) DEFAULT 'ATENDENTE' CHECK(CARGO IN ('GERENTE', 'VENDEDOR', 'ATENDENTE'))
);

 CREATE TABLE IF NOT EXISTS VENDAS (
    ID_VENDAS INT  PRIMARY KEY,
    ID_CLIENTES INT ,
    ID_PRODUTOS INT ,
    DATA_VENDA DATE,
    QUANTIDADE INT NOT NULL,
       FOREIGN KEY (ID_CLIENTES) REFERENCES CLIENTES(ID_CLIENTES),
    FOREIGN KEY (ID_ProdutoS) REFERENCES PRODUTOS(ID_PRODUTOS)
   
);

ALTER TABLE CLIENTES
ADD TELEFONE VARCHAR(20) NOT NULL   


ALTER TABLE PRODUTOS 
ALTER COLUMN DESCRICAO TYPE VARCHAR(30);

ALTER TABLE PEDIDOS
DROP CONSTRAINT ID_CLIENTES;

ALTER TABLE EMPREGADOS
RENAME TO FUNCIONARIOS;

============
DML
================


INSERT INTO CLIENTES (ID_CLIENTES, NOME, SOBRENOME, EMAIL,TELEFONE )
VALUES (5 ,'cesar', 'julio' ,'cesar@example.com', '5555555555');

    INSERT INTO PRODUTOS (ID_PRODUTOS,PNOME, DESCRICAO, PRECO)
    VALUES (2, 'BANANA','MADURA', 5.00);

    INSERT INTO PEDIDOS_PRODUTOS (ID_PEDIDIO,ID_PRODUTOS)
    VALUES (1,1);

    INSERT INTO CATEGORIAS (ID_CATEGORIAS,CNOME )
VALUES (3,'TECNOLOGIA');


    INSERT INTO PRODUTOS_CATEGORIAS (ID_PRODUTOS,ID_CATEGORIAS)
    VALUES (3,3);

    
    INSERT INTO FUNCIONARIOS (ID_EMPREGADOS, ENOME, ESOBRENOME,CARGO)
    VALUES   (5, 'PEDRO', 'OLIVEIRA', 'ATENDENTE');


    INSERT INTO VENDAS (ID_VENDAS, ID_CLIENTES, ID_PRODUTOS,DATA_VENDA,QUANTIDADE)
    VALUES   (1,1,1,'2024-04-21',2);

UPDATE produtoS
SET PRECO = 32.00
WHERE ID_PRODUTOS = 1

UPDATE FUNCIONARIOS
SET CARGO = 'VENDEDOR'
WHERE ID_EMPREGADOS = 5

DELETE FROM PEDIDOS_produtos
WHERE ID_PEDIDOS = 3;

DELETE FROM PEDIDOS
WHERE ID_PEDIDOS = 3;

DELETE FROM VENDAS
WHERE ID_VENDAS = 2;

DELETE FROM CLIENTES
WHERE ID_CLIENTES = 2;

DELETE FROM PEDIDOS_PRODUTOS
WHERE ID_PRODUTOS = 1;

DELETE FROM PRODUTOS_CATEGORIAS
WHERE ID_PRODUTOS = 1;

DELETE FROM VENDAS
WHERE ID_VENDAS = 1;

DELETE FROM PRODUTOS
WHERE ID_PRODUTOS = 1;

DELETE FROM FUNCIONARIOS
WHERE ID_EMPREGADOS = 1;

SELECT * FROM Pedidos WHERE  Status = 'EM ANDAMENTO';